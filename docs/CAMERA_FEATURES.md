# 摄像头监控功能

## 功能概述

在ScadaWorkshopDashboard中新增了摄像头监控功能，可以实时访问和显示本地摄像头画面。

## 功能特性

### 1. 多摄像头支持
- 支持同时监控多个摄像头
- 每个生产线都有独立的摄像头监控区域
- 可以切换不同的摄像头设备

### 2. 实时视频流
- 使用WebRTC API访问本地摄像头
- 支持高清视频流（1280x720，30fps）
- 实时显示摄像头画面

### 3. 设备管理
- 自动检测可用的摄像头设备
- 支持设备选择和切换
- 显示设备状态和数量

### 4. 错误处理
- 完善的错误提示机制
- 处理权限拒绝、设备占用等常见问题
- 用户友好的错误信息

## 使用方法

### 访问摄像头监控

1. **通过主界面访问**
   - 登录系统后，点击导航栏中的"车间大屏"
   - 在车间大屏页面顶部可以看到摄像头监控区域

2. **直接访问测试页面**
   - 访问 `http://localhost:3000/camera-test`
   - 这是专门的摄像头功能测试页面

### 操作步骤

1. **启动摄像头**
   - 点击摄像头组件中的"启动"按钮
   - 首次使用时会请求摄像头权限，请允许访问

2. **选择设备**
   - 从下拉菜单中选择要使用的摄像头设备
   - 如果有多个摄像头，可以切换不同设备

3. **停止摄像头**
   - 点击"停止"按钮关闭摄像头
   - 组件会自动清理资源

## 技术实现

### 核心技术
- **WebRTC API**: 用于访问本地摄像头
- **React Hooks**: 状态管理和副作用处理
- **TypeScript**: 类型安全的代码实现
- **Tailwind CSS**: 响应式UI设计

### 组件结构
```
CameraMonitor.tsx
├── 设备检测和选择
├── 视频流管理
├── 错误处理
└── UI界面
```

### 主要功能模块

1. **设备管理**
   ```typescript
   const getCameraDevices = useCallback(async () => {
     const devices = await navigator.mediaDevices.enumerateDevices();
     const videoDevices = devices.filter(device => device.kind === 'videoinput');
   }, []);
   ```

2. **视频流控制**
   ```typescript
   const startCamera = useCallback(async () => {
     const stream = await navigator.mediaDevices.getUserMedia(constraints);
     videoRef.current.srcObject = stream;
   }, [selectedDevice]);
   ```

3. **错误处理**
   ```typescript
   if (err.name === 'NotAllowedError') {
     setError('摄像头访问被拒绝，请允许浏览器访问摄像头');
   }
   ```

## 浏览器兼容性

- Chrome 53+
- Firefox 36+
- Safari 11+
- Edge 79+

## 安全注意事项

1. **HTTPS要求**: 在生产环境中，摄像头访问需要HTTPS协议
2. **权限管理**: 浏览器会请求摄像头访问权限
3. **隐私保护**: 视频流仅在本地处理，不会上传到服务器

## 故障排除

### 常见问题

1. **摄像头无法启动**
   - 检查浏览器权限设置
   - 确认摄像头未被其他应用占用
   - 尝试刷新页面重新授权

2. **没有可用的摄像头设备**
   - 检查设备连接
   - 确认摄像头驱动正常
   - 尝试重新插拔摄像头

3. **视频画面卡顿**
   - 降低视频分辨率
   - 检查系统资源使用情况
   - 关闭其他占用摄像头的应用

### 调试信息

在浏览器控制台中可以看到详细的调试信息：
- 设备检测结果
- 权限状态
- 错误详情

## 未来扩展

1. **录制功能**: 添加视频录制和保存功能
2. **截图功能**: 支持实时截图
3. **多画面布局**: 支持更多摄像头同时显示
4. **远程监控**: 支持网络摄像头接入
5. **AI分析**: 集成计算机视觉分析功能 